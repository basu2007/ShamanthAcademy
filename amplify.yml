version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm install
    build:
      commands:
        - echo "ðŸš€ Building Shamanth Academy..."
        # 1. Inject API Gateway URL from Amplify Environment Variable
        - |
          if [ ! -z "$BACKEND_API_URL" ]; then
            echo "âœ… BACKEND_API_URL detected. Injecting into build..."
            # Use | as delimiter for sed to handle slashes in URLs safely
            sed -i "s|INSERT_AWS_API_URL_HERE|$BACKEND_API_URL|g" services/db.ts
            echo "ðŸ”— API Target set successfully."
          else
            echo "âš ï¸ Warning: BACKEND_API_URL environment variable is missing."
            echo "ðŸ‘‰ Go to: Amplify Console > App Settings > Environment Variables and add BACKEND_API_URL."
          fi
        # 2. Run the custom build script
        - node build.js
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
